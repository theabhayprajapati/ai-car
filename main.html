<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            background: darkgray;
            overflow: hidden;
            text-align: center;
        }

        #canvas {
            /* height: 100vh; */
            /* width: 6000px; */
            background: lightgray;
        }
    </style>
    <title>Self-Driving Car -No Lib's</title>

</head>

<body>
    <canvas id="canvas">

    </canvas>
    <script>


        class Car {
            constructor(x, y, width, height) {

                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;


                this.speed = 0;
                this.acceleration = 0.2;
                this.maxSpeed = 3;
                this.friction = 0.05;
                this.angle = 0;
                this.controls = new Controlls();

            }

            update() {
                if (this.controls.forward) {
                    this.speed += this.acceleration;
                }
                if (this.controls.reverse) {
                    this.speed -= this.acceleration;
                }
                if (this.speed > this.maxSpeed) {
                    this.speed = this.maxSpeed;
                }
                if (this.speed < -this.maxSpeed / 2) {
                    this.speed = -this.maxSpeed / 2;
                }
                if (this.speed > 0) {
                    this.speed -= this.friction;
                }
                if (this.speed < 0) {
                    this.speed += this.friction;
                }
                if (Math.abs(this.speed) < (this.friction)) {
                    this.speed = 0;
                }
                // this.x += this.speed;
                if (this.speed != 0) {
                    const flip = this.speed > 0 ? 1 : -1;
                    if (this.controls.left) {
                        this.angle -= 0.03;

                    }
                    if (this.controls.right) {
                        this.angle += 0.03;
                    }
                }
                this.x -= Math.sin(this.angle) * this.speed;
                this.y -= Math.cos(this.angle) * this.speed;

            }
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(-this.angle);
                // ctx.fillStyle = '#ff0000';
                ctx.beginPath();
                ctx.rect(
                    -this.width / 2,
                    -this.height / 2,
                    this.width,
                    this.height

                )
                ctx.fill();
                ctx.restore();
            }
        }
        class Controlls {
            constructor(params) {
                this.forward = false;
                this.left = false;
                this.right = false;
                this.reverse = false;
                this.#addKeyListeners();
            }
            #addKeyListeners() {
                document.onkeydown = (e) => {
                    switch (e.key) {
                        case 'ArrowLeft':
                            this.left = true;
                            break;
                        case 'ArrowRight':
                            this.right = true;
                            break;
                        case 'ArrowUp':
                            this.forward = true;
                            break;
                        case 'ArrowDown':
                            this.reverse = true;
                            break;

                    }
                    console.table(this)
                }
                document.onkeyup = (e) => {
                    switch (e.key) {
                        case 'ArrowLeft':
                            this.left = false;
                            break;
                        case 'ArrowRight':
                            this.right = false;
                            break;
                        case 'ArrowUp':
                            this.forward = false;
                            break;
                        case 'ArrowDown':
                            this.reverse = false;
                            break;

                    }
                    console.table(this)
                }
            }
        }
        const canvas = document.getElementById('canvas');
        // canvas.clientHeight = window.innerHeight;
        canvas.width = 600;
        const ctx = canvas.getContext('2d');
        const car = new Car(100, 100, 30, 50)

        const animate = () => {
            car.update();
            canvas.height = window.innerHeight;
            car.draw(ctx);
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>

</html>